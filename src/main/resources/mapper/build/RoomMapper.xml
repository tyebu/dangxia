<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wxc.dangxia.dao.build.IRoomDao">

    <!--根据条件获得房间信息-->
    <select id="getRoomInfoByCondition" resultType="map" parameterType="map">
      SELECT
        r.room_id,
        r.room_num,
        r.room_size,
        r.people_num,
        r.room_rent,
        r.people_rent,
        r.start_date,
        r.end_date,
        r.created_user,
        DATE_FORMAT(r.created_date, '%Y-%m-%d %h:%i:%s') as created_date,
        r.modify_user,
        DATE_FORMAT(r.modify_date, '%Y-%m-%d %h:%i:%s') as modify_date,
        r.is_del,
        b.building_id,
        b.building_name,
        a.area_name,
        a.neighbourhood,
        l.landlord_id,
        l.landlord_name,
        l.landlord_phone,
        l.landlord_sex,
        rt.room_type_id,
        rt.room_type_name
      FROM
        room r
      LEFT JOIN building b ON (r.building_id = b.building_id)
      LEFT JOIN area a ON (b.area_id = a.area_id)
      LEFT JOIN landlord l ON (l.landlord_id = r.landlord_id)
      LEFT JOIN room_type rt ON (r.room_type_id = rt.room_type_id)
      <where>
          <if test="buildingId != null and buildingId != ''">
              r.building_id = #{buildingId}
          </if>
          <if test="roomNum != null and roomNum != ''">
              AND r.room_num = #{roomNum}
          </if>
          <if test="startDate != null and startDate != ''">
              <![CDATA[ AND DATE_FORMAT(r.start_date, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d')   ]]>
          </if>
          <if test="endDate != null and endDate != ''">
              <![CDATA[  AND DATE_FORMAT(r.end_date,, '%Y-%m-%d') <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')   ]]>
          </if>
          <if test="roomTypeId != null and roomTypeId != ''">
              AND r.room_type_id = #{roomTypeId}
          </if>
          <if test="landlordName != null and landlordName != ''">
              AND l.landlord_name = #{landlordName}
          </if>
      </where>
      ORDER BY r.created_date DESC
    </select>
    <!--获得已有房间的大小-->
    <select id="getRoomSize" resultType="int">
        SELECT
          DISTINCT  room_size
        FROM
          room
    </select>
    <!--获取所有房间类型-->
    <select id="getRoomType" resultType="map" parameterType="map">
        SELECT
          room_type_id,
          room_type_name
        FROM room_type
        <where>
            <if test="roomTypeId != null and roomTypeId != ''">
              room_type_id = #{roomTypeId}
            </if>
        </where>
    </select>
    <!--获得数据条数-->
    <select id="getCountByCondition" resultType="int" parameterType="map">
        SELECT
          count(*)
        FROM
          room
    </select>
    <!--添加房间-->
    <insert id="insertRoomInfo" parameterType="map">
      INSERT INTO room
        (
          room_num,
          room_size,
          room_area,
          room_type_id,
          start_date,
          end_date,
          landlord_id,
          building_id,
          created_user,
          created_date,
          record
        )
        VALUES
        (
          #{roomNum},
          #{roomSize},
          #{roomArea},
          #{roomTypeId},
          #{startDate},
          #{endDate},
          #{landlordId},
          null,
          NOW(),
          #{record}
        )
    </insert>
</mapper>