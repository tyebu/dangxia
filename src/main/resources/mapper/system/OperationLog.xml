<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wxc.dangxia.dao.system.IOperationLogDao">

    <sql id="operationLogField">
        id
        ,
        username,
        operate_type,
        description,
        method,
        params,
        ip,
        create_date
    </sql>

    <!--java类与数据库字段进行映射-->
    <resultMap id="operationMap" type="com.wxc.dangxia.entity.OperationLog">
        <id property="id" column="id"></id>
        <result property="username" column="username"></result>
        <result property="operateType" column="operate_type"></result>
        <result property="description" column="description"></result>
        <result property="method" column="method"></result>
        <result property="params" column="params"></result>
        <result property="ip" column="ip"></result>
        <result property="createDate" column="create_date"></result>
    </resultMap>
    <!--插入一条日志-->
    <insert id="addOperationLog" parameterType="com.wxc.dangxia.entity.OperationLog">
        INSERT INTO tbl_operation_log (<include refid="operationLogField"></include>) VALUES
        (NULL,#{username},#{operateType},#{description},#{method},#{params},#{ip},#{createDate})
    </insert>
    <!--获得部分日志信息 rowCount 查询的行数-->
    <select id="getOperationLogLimit" parameterType="map" resultType="map">
        SELECT id,username,operate_type operateType,description,ip,create_date FROM tbl_operation_log
        ORDER BY create_date DESC
        <if test="rowCount != null and rowCount != ''">
            LIMIT (0,${rowCount})
        </if>
    </select>
    <!--查询所有的日志记录-->
    <select id="getOperationLogAll" parameterType="map" resultMap="operationMap">
        SELECT <include refid="operationLogField"></include> FROM tbl_operation_log
        <where>
            1=1
            <if test="username !=null and username!=''">
                AND username LIKE CONCAT('%',CONCAT(#{username},'%'))
            </if>
            <if test="ip !=null and ip!=''">
                AND ip LIKE CONCAT('%',CONCAT(#{ip},'%'))
            </if>
            <if test="startDate !=null and startDate!=''">
                AND create_date &gt;= #{startDate}
            </if>
            <if test="endDate !=null and endDate!=''">
                AND create_date &lt;= #{endDate}
            </if>
            <if test="operateType !=null and operateType!=''">
                AND operate_type LIKE CONCAT('%',CONCAT(#{operateType},'%'))
            </if>
        </where>
        <if test="field==null or field ==''">
            ORDER BY create_date DESC
        </if>
        <if test="field == 'id'">
            ORDER BY id ${order}
        </if>
        <if test="field == 'createDate'">
            ORDER BY create_date ${order}
        </if>
    </select>
    <!--查询所有的日志记录总条数-->
    <select id="getOperationLogTotalAll" parameterType="map" resultType="integer">
        SELECT COUNT(*) FROM tbl_operation_log
        <where>
            1=1
            <if test="username !=null and username!=''">
                AND username LIKE CONCAT('%',CONCAT(#{username},'%'))
            </if>
            <if test="ip !=null and ip!=''">
                AND ip LIKE CONCAT('%',CONCAT(#{ip},'%'))
            </if>
            <if test="startDate !=null and startDate!=''">
                AND create_date &gt;= #{startDate}
            </if>
            <if test="endDate !=null and endDate!=''">
                AND create_date &lt;= #{endDate}
            </if>
            <if test="operateType !=null and operateType!=''">
                AND operate_type LIKE CONCAT('%',CONCAT(#{operateType},'%'))
            </if>
        </where>
    </select>
</mapper>